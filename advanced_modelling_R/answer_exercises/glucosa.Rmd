---
title: "Example longitudinal data"
author: "Juan R Gonzalez"
date: "16 de mayo de 2019"
output: 
  BiocStyle::html_document:
    toc_depth: 3
  BiocStyle::pdf_document:
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "",
                      message = FALSE, warning = FALSE,
                      cache=TRUE)
```


# Load data

```{r load}
setwd("c:/juan/CREAL/GitHub/PrivateTeachingMaterials/advanced_modelling_R/data")
dat <- read.delim("Base_Curso_F4D.txt", dec=",", 
                  na.strings = c("#N/A"))
                    
head(dat)
str(dat)
```


# Data in long format

```{r long2}
medidas <- c(paste(1:3, 2016, sep="_"), 
             paste(1:3, 2017, sep="_"), 
             paste(1:3, 2018, sep="_"))
medidas

vars <- paste0("P.CINTURA", medidas)

datS <- dat[ , c("ID_FAMILIAR", "ZONA", vars)]
dat2 <- reshape(datS, direction="long",
                varying = list(vars),
                idvar = c("ID_FAMILIAR","ZONA"),
                v.names = c("cintura"),
                timevar = "tiempo", times=1:9)
head(dat2)

dat2$familia <- substr(dat2$ID_FAMILIAR, 1, 8)
head(dat2)


write.table(dat2, file="cintura.txt", sep="\t", quote=FALSE,
            row.names = FALSE)
```


```{r long}
datS <- dat[ , c("ID_FAMILIAR", "ZONA", 
                 grep("^GLUC", names(dat), value = TRUE))]

head(datS)

dat3 <- reshape(datS, direction="long",
                varying = list(grep("^GLUC", names(dat), value = TRUE)),
                idvar = c("ID_FAMILIAR","ZONA"),
                v.names = c("glucosa"),
                timevar = "tiempo", times=1:3)
dat3$familia <- substr(dat3$ID_FAMILIAR, 1, 8)
head(dat3)

write.table(dat3, file="glucosa.txt", sep="\t", quote=FALSE,
            row.names = FALSE)
```



